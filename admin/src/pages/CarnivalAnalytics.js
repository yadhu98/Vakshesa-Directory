import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useEffect, useState } from 'react';
import { useNavigate } from 'react-router-dom';
import { ArrowLeft, RefreshCw } from 'lucide-react';
import toast, { Toaster } from 'react-hot-toast';
import api from '../services/api';
const CarnivalAnalytics = () => {
    const navigate = useNavigate();
    const [overview, setOverview] = useState(null);
    const [stalls, setStalls] = useState([]);
    const [userTransactions, setUserTransactions] = useState([]);
    const [recharges, setRecharges] = useState([]);
    const [rechargesSummary, setRechargesSummary] = useState(null);
    const [loading, setLoading] = useState(true);
    const [activeTab, setActiveTab] = useState('overview');
    useEffect(() => {
        loadAnalytics();
    }, []);
    const loadAnalytics = async () => {
        setLoading(true);
        try {
            const [overviewRes, stallsRes, usersRes, rechargesRes] = await Promise.all([
                api.get('/analytics/carnival/overview'),
                api.get('/analytics/carnival/stalls/gross'),
                api.get('/analytics/carnival/transactions/by-user'),
                api.get('/analytics/carnival/recharges'),
            ]);
            setOverview(overviewRes.data.overview);
            setStalls(stallsRes.data.stalls || []);
            setUserTransactions(usersRes.data.users || []);
            setRecharges(rechargesRes.data.recharges || []);
            setRechargesSummary(rechargesRes.data.summary);
            toast.success('Analytics data loaded successfully');
        }
        catch (error) {
            console.error('Load analytics error:', error);
            toast.error('Failed to load analytics data');
        }
        finally {
            setLoading(false);
        }
    };
    if (loading) {
        return (_jsx("div", { className: "flex items-center justify-center h-screen", children: _jsx("div", { className: "text-xl", children: "Loading analytics..." }) }));
    }
    return (_jsxs("div", { className: "p-6 max-w-7xl mx-auto", children: [_jsx(Toaster, { position: "top-right" }), _jsxs("div", { className: "flex items-center justify-between mb-6", children: [_jsxs("div", { className: "flex items-center gap-4", children: [_jsx("button", { onClick: () => navigate(-1), className: "p-2 hover:bg-gray-100 rounded-lg transition-colors", title: "Go back", children: _jsx(ArrowLeft, { size: 24, className: "text-gray-700" }) }), _jsx("h1", { className: "text-3xl font-bold text-gray-900", children: "Carnival Analytics" })] }), _jsxs("button", { onClick: loadAnalytics, className: "px-5 py-2.5 bg-black text-white rounded-lg hover:bg-gray-800 transition-colors font-medium min-w-[140px] flex items-center gap-2", children: [_jsx(RefreshCw, { size: 18 }), "Refresh Data"] })] }), _jsxs("div", { className: "flex space-x-2 mb-6 border-b", children: [_jsx("button", { onClick: () => setActiveTab('overview'), className: `px-5 py-3 font-medium transition-colors min-w-[120px] ${activeTab === 'overview'
                            ? 'border-b-2 border-blue-500 text-blue-600'
                            : 'text-gray-600 hover:text-gray-800 hover:bg-gray-50'}`, children: "Overview" }), _jsx("button", { onClick: () => setActiveTab('stalls'), className: `px-5 py-3 font-medium transition-colors min-w-[120px] ${activeTab === 'stalls'
                            ? 'border-b-2 border-blue-500 text-blue-600'
                            : 'text-gray-600 hover:text-gray-800 hover:bg-gray-50'}`, children: "Stall Revenue" }), _jsx("button", { onClick: () => setActiveTab('users'), className: `px-5 py-3 font-medium transition-colors min-w-[120px] ${activeTab === 'users'
                            ? 'border-b-2 border-blue-500 text-blue-600'
                            : 'text-gray-600 hover:text-gray-800 hover:bg-gray-50'}`, children: "User Spending" }), _jsx("button", { onClick: () => setActiveTab('recharges'), className: `px-5 py-3 font-medium transition-colors min-w-[140px] ${activeTab === 'recharges'
                            ? 'border-b-2 border-blue-500 text-blue-600'
                            : 'text-gray-600 hover:text-gray-800 hover:bg-gray-50'}`, children: "Token Recharges" })] }), activeTab === 'overview' && overview && (_jsx("div", { className: "space-y-4", children: _jsxs("div", { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4", children: [_jsxs("div", { className: "bg-blue-50 p-6 rounded-lg border border-blue-200", children: [_jsx("div", { className: "text-blue-600 text-sm font-medium mb-2", children: "Total Participants" }), _jsx("div", { className: "text-3xl font-bold text-blue-900", children: overview.totalParticipants })] }), _jsxs("div", { className: "bg-green-50 p-6 rounded-lg border border-green-200", children: [_jsx("div", { className: "text-green-600 text-sm font-medium mb-2", children: "Total Transactions" }), _jsx("div", { className: "text-3xl font-bold text-green-900", children: overview.totalTransactions }), _jsxs("div", { className: "text-sm text-green-600 mt-1", children: [overview.completedTransactions, " completed"] })] }), _jsxs("div", { className: "bg-purple-50 p-6 rounded-lg border border-purple-200", children: [_jsx("div", { className: "text-purple-600 text-sm font-medium mb-2", children: "Tokens Exchanged" }), _jsxs("div", { className: "text-3xl font-bold text-purple-900", children: ["\uD83E\uDE99 ", overview.totalTokensExchanged] })] }), _jsxs("div", { className: "bg-yellow-50 p-6 rounded-lg border border-yellow-200", children: [_jsx("div", { className: "text-yellow-600 text-sm font-medium mb-2", children: "Tokens Recharged" }), _jsxs("div", { className: "text-3xl font-bold text-yellow-900", children: ["\uD83E\uDE99 ", overview.totalTokensRecharged] })] }), _jsxs("div", { className: "bg-indigo-50 p-6 rounded-lg border border-indigo-200", children: [_jsx("div", { className: "text-indigo-600 text-sm font-medium mb-2", children: "Net Token Flow" }), _jsxs("div", { className: "text-3xl font-bold text-indigo-900", children: ["\uD83E\uDE99 ", overview.netTokenFlow] }), _jsx("div", { className: "text-sm text-indigo-600 mt-1", children: overview.netTokenFlow > 0 ? 'Surplus' : 'Deficit' })] }), _jsxs("div", { className: "bg-pink-50 p-6 rounded-lg border border-pink-200", children: [_jsx("div", { className: "text-pink-600 text-sm font-medium mb-2", children: "Average per Transaction" }), _jsxs("div", { className: "text-3xl font-bold text-pink-900", children: ["\uD83E\uDE99 ", overview.totalTransactions > 0 ? Math.round(overview.totalTokensExchanged / overview.totalTransactions) : 0] })] })] }) })), activeTab === 'stalls' && (_jsx("div", { className: "space-y-4", children: _jsx("div", { className: "bg-white rounded-lg shadow overflow-hidden", children: _jsxs("table", { className: "min-w-full divide-y divide-gray-200", children: [_jsx("thead", { className: "bg-gray-50", children: _jsxs("tr", { children: [_jsx("th", { className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider", children: "Rank" }), _jsx("th", { className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider", children: "Stall Name" }), _jsx("th", { className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider", children: "Category" }), _jsx("th", { className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider", children: "Total Revenue" }), _jsx("th", { className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider", children: "Participants" }), _jsx("th", { className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider", children: "Avg Tokens" })] }) }), _jsx("tbody", { className: "bg-white divide-y divide-gray-200", children: stalls.map((stall, index) => (_jsxs("tr", { className: index === 0 ? 'bg-yellow-50' : '', children: [_jsx("td", { className: "px-6 py-4 whitespace-nowrap", children: _jsxs("div", { className: "text-sm font-medium text-gray-900", children: [index === 0 && 'ðŸ¥‡', " ", index === 1 && 'ðŸ¥ˆ', " ", index === 2 && 'ðŸ¥‰', " #", index + 1] }) }), _jsx("td", { className: "px-6 py-4 whitespace-nowrap", children: _jsx("div", { className: "text-sm font-medium text-gray-900", children: stall.stallName }) }), _jsx("td", { className: "px-6 py-4 whitespace-nowrap", children: _jsx("span", { className: "px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800", children: stall.category }) }), _jsx("td", { className: "px-6 py-4 whitespace-nowrap", children: _jsxs("div", { className: "text-sm font-bold text-green-600", children: ["\uD83E\uDE99 ", stall.totalRevenue] }) }), _jsx("td", { className: "px-6 py-4 whitespace-nowrap", children: _jsxs("div", { className: "text-sm text-gray-900", children: [stall.participantCount, " (", stall.completedCount, " completed)"] }) }), _jsx("td", { className: "px-6 py-4 whitespace-nowrap", children: _jsxs("div", { className: "text-sm text-gray-900", children: ["\uD83E\uDE99 ", Math.round(stall.averageTokensPerParticipant)] }) })] }, stall.stallId))) })] }) }) })), activeTab === 'users' && (_jsx("div", { className: "space-y-4", children: _jsx("div", { className: "bg-white rounded-lg shadow overflow-hidden", children: _jsxs("table", { className: "min-w-full divide-y divide-gray-200", children: [_jsx("thead", { className: "bg-gray-50", children: _jsxs("tr", { children: [_jsx("th", { className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider", children: "Rank" }), _jsx("th", { className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider", children: "User Name" }), _jsx("th", { className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider", children: "Email" }), _jsx("th", { className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider", children: "Total Spent" }), _jsx("th", { className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider", children: "Transactions" })] }) }), _jsx("tbody", { className: "bg-white divide-y divide-gray-200", children: userTransactions.map((user, index) => (_jsxs("tr", { className: index === 0 ? 'bg-purple-50' : '', children: [_jsx("td", { className: "px-6 py-4 whitespace-nowrap", children: _jsxs("div", { className: "text-sm font-medium text-gray-900", children: [index === 0 && 'ðŸ¥‡', " ", index === 1 && 'ðŸ¥ˆ', " ", index === 2 && 'ðŸ¥‰', " #", index + 1] }) }), _jsx("td", { className: "px-6 py-4 whitespace-nowrap", children: _jsx("div", { className: "text-sm font-medium text-gray-900", children: user.userName }) }), _jsx("td", { className: "px-6 py-4 whitespace-nowrap", children: _jsx("div", { className: "text-sm text-gray-500", children: user.userEmail }) }), _jsx("td", { className: "px-6 py-4 whitespace-nowrap", children: _jsxs("div", { className: "text-sm font-bold text-red-600", children: ["\uD83E\uDE99 ", user.totalSpent] }) }), _jsx("td", { className: "px-6 py-4 whitespace-nowrap", children: _jsx("div", { className: "text-sm text-gray-900", children: user.transactionCount }) })] }, user.userId))) })] }) }) })), activeTab === 'recharges' && (_jsxs("div", { className: "space-y-4", children: [rechargesSummary && (_jsxs("div", { className: "grid grid-cols-1 md:grid-cols-3 gap-4 mb-6", children: [_jsxs("div", { className: "bg-green-50 p-6 rounded-lg border border-green-200", children: [_jsx("div", { className: "text-green-600 text-sm font-medium mb-2", children: "Total Recharged" }), _jsxs("div", { className: "text-3xl font-bold text-green-900", children: ["\uD83E\uDE99 ", rechargesSummary.totalRecharged] })] }), _jsxs("div", { className: "bg-blue-50 p-6 rounded-lg border border-blue-200", children: [_jsx("div", { className: "text-blue-600 text-sm font-medium mb-2", children: "Total Recharges" }), _jsx("div", { className: "text-3xl font-bold text-blue-900", children: rechargesSummary.totalRechargeCount })] }), _jsxs("div", { className: "bg-purple-50 p-6 rounded-lg border border-purple-200", children: [_jsx("div", { className: "text-purple-600 text-sm font-medium mb-2", children: "Average Recharge" }), _jsxs("div", { className: "text-3xl font-bold text-purple-900", children: ["\uD83E\uDE99 ", Math.round(rechargesSummary.averageRechargeAmount)] })] })] })), _jsx("div", { className: "bg-white rounded-lg shadow overflow-hidden", children: _jsxs("table", { className: "min-w-full divide-y divide-gray-200", children: [_jsx("thead", { className: "bg-gray-50", children: _jsxs("tr", { children: [_jsx("th", { className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider", children: "Date" }), _jsx("th", { className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider", children: "User" }), _jsx("th", { className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider", children: "Amount" }), _jsx("th", { className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider", children: "Admin" })] }) }), _jsx("tbody", { className: "bg-white divide-y divide-gray-200", children: recharges.map((recharge) => (_jsxs("tr", { children: [_jsx("td", { className: "px-6 py-4 whitespace-nowrap", children: _jsx("div", { className: "text-sm text-gray-900", children: new Date(recharge.createdAt).toLocaleString('en-US', {
                                                        month: 'short',
                                                        day: 'numeric',
                                                        hour: '2-digit',
                                                        minute: '2-digit',
                                                    }) }) }), _jsxs("td", { className: "px-6 py-4 whitespace-nowrap", children: [_jsx("div", { className: "text-sm font-medium text-gray-900", children: recharge.userName }), _jsx("div", { className: "text-sm text-gray-500", children: recharge.userEmail })] }), _jsx("td", { className: "px-6 py-4 whitespace-nowrap", children: _jsxs("div", { className: "text-sm font-bold text-green-600", children: ["\uD83E\uDE99 ", recharge.amount] }) }), _jsx("td", { className: "px-6 py-4 whitespace-nowrap", children: _jsx("div", { className: "text-sm text-gray-900", children: recharge.adminName }) })] }, recharge._id))) })] }) })] }))] }));
};
export default CarnivalAnalytics;
